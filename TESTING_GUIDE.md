# üß™ –¢–µ—Å—Ç—ñ–ª–µ—É –ù“±—Å“õ–∞—É–ª—ã“ì—ã - RabbitMQ + Spring Boot

## üìã –¢–∞–ø—Å—ã—Ä–º–∞–Ω—ã“£ –ú–∞“ì—ã–Ω–∞—Å—ã

–ë“±–ª –∂–æ–±–∞–¥–∞ **–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—Ç–µ—Ä –∞—Ä–∞—Å—ã–Ω–¥–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–¥—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞ –∞–ª–º–∞—Å—É** “õ–æ–ª–¥–∞–Ω—ã–ª–∞–¥—ã:

### üéØ –ù–µ “Ø—à—ñ–Ω “õ–∞–∂–µ—Ç?

1. **Order Service** - –∑–∞–∫–∞–∑–¥–∞—Ä–¥—ã “õ–∞–±—ã–ª–¥–∞–π–¥—ã –∂”ô–Ω–µ RabbitMQ-“ì–∞ –∂—ñ–±–µ—Ä–µ–¥—ñ
2. **Notification Service** - –∑–∞–∫–∞–∑–¥–∞—Ä —Ç—É—Ä–∞–ª—ã —Ö–∞–±–∞—Ä–ª–∞–Ω–¥—ã—Ä—É–ª–∞—Ä–¥—ã –∞–ª–∞–¥—ã
3. **Topic Exchange** - –∞–π–º–∞“õ –±–æ–π—ã–Ω—à–∞ —Ö–∞–±–∞—Ä–ª–∞–º–∞–ª–∞—Ä–¥—ã –±”©–ª—ñ–ø –∂—ñ–±–µ—Ä–µ–¥—ñ

### üí° –ù–µ “Ø–π—Ä–µ–Ω–µ–º—ñ–∑?

- RabbitMQ Topic Exchange “õ–∞–ª–∞–π –∂“±–º—ã—Å —ñ—Å—Ç–µ–π–¥—ñ
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–¥—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞–ª–∞—Ä “õ–∞–ª–∞–π –∂—ñ–±–µ—Ä—ñ–ª–µ–¥—ñ –∂”ô–Ω–µ “õ–∞–±—ã–ª–¥–∞–Ω–∞–¥—ã
- –ê–π–º–∞“õ –±–æ–π—ã–Ω—à–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è (routing key)
- –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—Ç–µ—Ä –∞—Ä–∞—Å—ã–Ω–¥–∞“ì—ã –±–∞–π–ª–∞–Ω—ã—Å—Å—ã–∑ (decoupled) –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

---

## üöÄ –Ü—Å–∫–µ “ö–æ—Å—É

### 1Ô∏è‚É£ RabbitMQ (–µ–≥–µ—Ä —ñ—Å–∫–µ “õ–æ—Å—ã–ª–º–∞“ì–∞–Ω –±–æ–ª—Å–∞)
```bash
docker-compose up -d
```

### 2Ô∏è‚É£ Order Service (8080 –ø–æ—Ä—Ç)
IDE-–¥–µ `OrderServiceApplication`-–¥—ñ —ñ—Å–∫–µ “õ–æ—Å—ã“£—ã–∑

### 3Ô∏è‚É£ Notification Service (8081 –ø–æ—Ä—Ç)
IDE-–¥–µ `NotificationServiceApplication`-–¥—ñ —ñ—Å–∫–µ “õ–æ—Å—ã“£—ã–∑

---

## üìÆ Postman-–¥–∞ –¢–µ—Å—Ç—ñ–ª–µ—É

### ‚úÖ –¢–µ—Å—Ç 1: –ê–ª–º–∞—Ç—ã“ì–∞ –∑–∞–∫–∞–∑ –∂—ñ–±–µ—Ä—É

**Request:**
```
POST http://localhost:8080/order/almaty
Content-Type: application/json
```

**Body (JSON):**
```json
{
    "restaurant": "Pizza Palace –ê–ª–º–∞—Ç—ã",
    "courier": "–ù“±—Ä–ª–∞–Ω –ö—É—Ä—å–µ—Ä–æ–≤",
    "foods": ["–ü–∏—Ü—Ü–∞ –ú–∞—Ä–≥–∞—Ä–∏—Ç–∞", "–ö–æ–ª–∞", "–ö–∞—Ä—Ç–æ—à–∫–∞ —Ñ—Ä–∏"],
    "status": "New"
}
```

**–ö“Ø—Ç—ñ–ª–µ—Ç—ñ–Ω –ù”ô—Ç–∏–∂–µ:**
- Response: `"Order created and sent to region: almaty"` (200 OK)
- Notification Service –∫–æ–Ω—Å–æ–ª—å–¥–∞: `=== ALMATY ORDER NOTIFICATION ===` –∫”©—Ä—ñ–Ω–µ–¥—ñ

---

### ‚úÖ –¢–µ—Å—Ç 2: –ê—Å—Ç–∞–Ω–∞“ì–∞ –∑–∞–∫–∞–∑ –∂—ñ–±–µ—Ä—É

**Request:**
```
POST http://localhost:8080/order/astana
Content-Type: application/json
```

**Body (JSON):**
```json
{
    "restaurant": "Burger King –ê—Å—Ç–∞–Ω–∞",
    "courier": "–ê—Å—Ö–∞—Ç –î–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤",
    "foods": ["–ë—É—Ä–≥–µ—Ä", "–ö–æ–∫–∞-–ö–æ–ª–∞", "–ö–∞—Ä—Ç–æ—à–∫–∞"],
    "status": "New"
}
```

**–ö“Ø—Ç—ñ–ª–µ—Ç—ñ–Ω –ù”ô—Ç–∏–∂–µ:**
- Response: `"Order created and sent to region: astana"` (200 OK)
- Notification Service –∫–æ–Ω—Å–æ–ª—å–¥–∞: `=== ASTANA ORDER NOTIFICATION ===` –∫”©—Ä—ñ–Ω–µ–¥—ñ

---

### ‚úÖ –¢–µ—Å—Ç 3: –®—ã–º–∫–µ–Ω—Ç–∫–µ –∑–∞–∫–∞–∑ –∂—ñ–±–µ—Ä—É

**Request:**
```
POST http://localhost:8080/order/shymkent
Content-Type: application/json
```

**Body (JSON):**
```json
{
    "restaurant": "KFC –®—ã–º–∫–µ–Ω—Ç",
    "courier": "–°–∞–º–∞—Ç –î–æ—Å—Ç–∞–≤–∫–∞",
    "foods": ["–ö—Ä—ã–ª—ã—à–∫–∏", "–ü–∏—Ü—Ü–∞", "–§—Ä–µ—à"],
    "status": "Preparing"
}
```

**–ö“Ø—Ç—ñ–ª–µ—Ç—ñ–Ω –ù”ô—Ç–∏–∂–µ:**
- Response: `"Order created and sent to region: shymkent"` (200 OK)
- Notification Service –∫–æ–Ω—Å–æ–ª—å–¥–∞: `=== SHYMKENT ORDER NOTIFICATION ===` –∫”©—Ä—ñ–Ω–µ–¥—ñ

---

## üîç –ù–µ–Ω—ñ –¢–µ“£–≥–µ—Ä—É –ö–µ—Ä–µ–∫?

### 1. Order Service –∫–æ–Ω—Å–æ–ª—å–¥–∞:
```
Sending order to region: almaty with routing key: order.almaty
```

### 2. Notification Service –∫–æ–Ω—Å–æ–ª—å–¥–∞:
```
=== ALMATY ORDER NOTIFICATION ===
Restaurant: Pizza Palace –ê–ª–º–∞—Ç—ã
Courier: –ù“±—Ä–ª–∞–Ω –ö—É—Ä—å–µ—Ä–æ–≤
Foods: [–ü–∏—Ü—Ü–∞ –ú–∞—Ä–≥–∞—Ä–∏—Ç–∞, –ö–æ–ª–∞, –ö–∞—Ä—Ç–æ—à–∫–∞ —Ñ—Ä–∏]
Status: New
==================================
```

### 3. RabbitMQ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–Ω–¥–µ (http://localhost:15672):
- **Queues** –±”©–ª—ñ–º—ñ–Ω–¥–µ 4 –æ—á–µ—Ä–µ–¥—å –±–∞—Ä –µ–∫–µ–Ω—ñ–Ω –∫”©—Ä—É:
  - `almaty_orders_queue`
  - `astana_orders_queue`
  - `shymkent_orders_queue`
  - `all_orders_queue`
- **Exchanges** –±”©–ª—ñ–º—ñ–Ω–¥–µ `order-topic-exchange` –±–∞—Ä –µ–∫–µ–Ω—ñ–Ω –∫”©—Ä—É
- **Connections** –±”©–ª—ñ–º—ñ–Ω–¥–µ 2 “õ–æ—Å—ã–ª—ã–º –±–∞—Ä –µ–∫–µ–Ω—ñ–Ω –∫”©—Ä—É (Order Service + Notification Service)

---

## ‚ùì –°—ñ–∑ –ù–µ–Ω—ñ –ë–∞“õ—ã–ª–∞–π—Å—ã–∑?

1. **Routing Key –∂“±–º—ã—Å—ã:**
   - `order.almaty` ‚Üí —Ç–µ–∫ `almaty_orders_queue`-“ì–∞ –±–∞—Ä–∞–¥—ã
   - `order.astana` ‚Üí —Ç–µ–∫ `astana_orders_queue`-“ì–∞ –±–∞—Ä–∞–¥—ã
   - `order.#` pattern ‚Üí –±–∞—Ä–ª—ã“õ `all_orders_queue`-“ì–∞ –±–∞—Ä–∞–¥—ã

2. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–¥—ã–ª—ã“õ:**
   - Order Service –∑–∞–∫–∞–∑–¥—ã –∂—ñ–±–µ—Ä–≥–µ–Ω —Å–æ“£ –±—ñ—Ä–¥–µ–Ω response “õ–∞–π—Ç–∞—Ä–∞–¥—ã
   - Notification Service –ø–∞—Ä–∞–ª–ª–µ–ª—å –∂“±–º—ã—Å —ñ—Å—Ç–µ–π–¥—ñ

3. **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—Ç–µ—Ä —Ç”ô—É–µ–ª—Å—ñ–∑–¥—ñ–≥—ñ:**
   - –ï–∫–µ—É—ñ –±—ñ—Ä-–±—ñ—Ä—ñ–Ω–µ–Ω —Ç”ô—É–µ–ª—Å—ñ–∑
   - RabbitMQ –∞—Ä“õ—ã–ª—ã –±–∞–π–ª–∞–Ω—ã—Å–∞–¥—ã

---

## üêõ –ú“Ø–º–∫—ñ–Ω –ú”ô—Å–µ–ª–µ–ª–µ—Ä

### ‚ùå "Connection refused" “õ–∞—Ç–µ—Å—ñ
- RabbitMQ —ñ—Å–∫–µ “õ–æ—Å—ã–ª“ì–∞–Ω—ã–Ω —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑: `docker ps`
- –ü–æ—Ä—Ç 5672 –±–æ—Å –µ–∫–µ–Ω—ñ–Ω —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑

### ‚ùå "Exchange not found" “õ–∞—Ç–µ—Å—ñ
- Order Service-—Ç—ñ “õ–∞–π—Ç–∞ —ñ—Å–∫–µ “õ–æ—Å—ã“£—ã–∑ (exchange –∞–≤—Ç–æ–º–∞—Ç—Ç—ã “õ“±—Ä—ã–ª–∞–¥—ã)

### ‚ùå –•–∞–±–∞—Ä–ª–∞–º–∞ –∫–µ–ª–º–µ–π–¥—ñ
- Notification Service —ñ—Å–∫–µ “õ–æ—Å—ã–ª“ì–∞–Ω—ã–Ω —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑
- RabbitMQ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–Ω–¥–µ –æ—á–µ—Ä–µ–¥—å-–ª–µ—Ä “õ“±—Ä—ã–ª“ì–∞–Ω—ã–Ω —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑
- Routing key –¥“±—Ä—ã—Å –µ–∫–µ–Ω—ñ–Ω —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑

---

## üìä “ö–æ—Ä—ã—Ç—ã–Ω–¥—ã

–ë“±–ª —Ç–∞–ø—Å—ã—Ä–º–∞ —Å—ñ–∑–≥–µ –∫”©—Ä—Å–µ—Ç–µ–¥—ñ:
- ‚úÖ –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—Ç–µ—Ä “õ–∞–ª–∞–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–¥—ã —Ç“Ø—Ä–¥–µ —Ö–∞–±–∞—Ä–ª–∞–º–∞ –∞–ª–º–∞—Å–∞–¥—ã
- ‚úÖ Topic Exchange “õ–∞–ª–∞–π –∞–π–º–∞“õ –±–æ–π—ã–Ω—à–∞ —Ö–∞–±–∞—Ä–ª–∞–º–∞–ª–∞—Ä–¥—ã —Ç–∞—Ä–∞—Ç–∞–¥—ã
- ‚úÖ RabbitMQ –ø—Ä–∞–∫—Ç–∏–∫–∞–¥–∞ “õ–∞–ª–∞–π “õ–æ–ª–¥–∞–Ω—ã–ª–∞–¥—ã

**–°”ô—Ç—Ç—ñ —Ç–µ—Å—Ç—ñ–ª–µ—É!** üéâ

